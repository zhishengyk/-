<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LogStats 控制台</title>
  <link rel="stylesheet" href="/assets/app.css">
</head>
<body>
  <div class="noise" aria-hidden="true"></div>

  <div class="shell">
    <aside class="rail">
      <div class="brand">
        <div class="brand-icon">LS</div>
        <div>
          <h1>LogStats</h1>
          <p>Segment Tree Console</p>
        </div>
      </div>

      <nav class="menu" id="menu">
        <button class="menu-item active" data-view="overview">
          <strong>总览看板</strong>
          <span>统计与图表</span>
        </button>
        <button class="menu-item" data-view="auth">
          <strong>认证会话</strong>
          <span>登录与用户</span>
        </button>
        <button class="menu-item" data-view="ingest">
          <strong>日志导入</strong>
          <span>上传与解析</span>
        </button>
        <button class="menu-item" data-view="trend">
          <strong>错误趋势</strong>
          <span>时序分析</span>
        </button>
        <button class="menu-item" data-view="compare">
          <strong>区间对比</strong>
          <span>差值分析</span>
        </button>
        <button class="menu-item" data-view="runtime">
          <strong>运行日志</strong>
          <span>前端追踪</span>
        </button>
      </nav>

      <section class="rail-foot">
        <div class="chip-row">
          <span class="chip">DEV</span>
          <span class="chip">:18081</span>
        </div>
        <div class="chip-row">
          <span id="tokenBadge" class="chip chip-warn">未登录</span>
        </div>
      </section>
    </aside>

    <main class="stage">
      <header class="hero card">
        <div>
          <p class="eyebrow">Realtime Analytics</p>
          <h2>基于线段树的日志分析平台</h2>
          <p class="subtitle">登录、上传、统计、趋势和区间对比统一入口。</p>
          <div id="statusLine" class="status-line">系统就绪</div>
        </div>
        <div class="hero-actions">
          <button id="fillDemoBtn" class="btn ghost">填入示例时间</button>
          <button id="refreshBtn" class="btn solid">刷新看板</button>
        </div>
      </header>

      <section class="view active" data-view="overview">
        <article class="card reveal">
          <div class="card-head">
            <h3>查询时间范围</h3>
            <span class="tip">格式：yyyy-MM-dd HH:mm:ss</span>
          </div>
          <div class="field-grid two">
            <label class="field">
              <span>开始时间</span>
              <input id="start" value="2025-01-01 00:00:00">
            </label>
            <label class="field">
              <span>结束时间</span>
              <input id="end" value="2025-01-02 00:00:00">
            </label>
          </div>
          <div class="inline-actions">
            <button id="runOverviewBtn" class="btn solid">刷新统计</button>
            <button id="runCompareShortcutBtn" class="btn warm">运行区间对比</button>
          </div>
        </article>

        <article class="card reveal">
          <div class="card-head">
            <h3>关键指标</h3>
          </div>
          <div class="kpis">
            <div class="kpi">
              <span>总日志量</span>
              <strong id="totalCount">-</strong>
            </div>
            <div class="kpi">
              <span>平均响应 (ms)</span>
              <strong id="avgResponse">-</strong>
            </div>
            <div class="kpi">
              <span>最小响应 (ms)</span>
              <strong id="minResponse">-</strong>
            </div>
            <div class="kpi">
              <span>最大响应 (ms)</span>
              <strong id="maxResponse">-</strong>
            </div>
          </div>
          <div id="levelChart" class="chart"></div>
          <div id="statusChart" class="chart"></div>
        </article>
      </section>

      <section class="view" data-view="auth">
        <article class="card auth-shell reveal">
          <div class="auth-grid">
            <section class="auth-pane auth-pane-primary">
              <div class="auth-header">
                <h3>账号登录</h3>
                <span>Demo：admin / admin123</span>
              </div>
              <div class="field-grid two compact">
                <label class="field">
                  <span>用户名</span>
                  <input id="username" value="admin">
                </label>
                <label class="field">
                  <span>密码</span>
                  <input id="password" type="password" value="admin123">
                </label>
              </div>
              <div class="inline-actions auth-actions">
                <button id="loginBtn" class="btn solid">登录</button>
                <button id="logoutBtn" class="btn ghost">退出</button>
                <button id="whoamiBtn" class="btn warm">查询当前用户</button>
              </div>
              <p id="loginHint" class="tip auth-tip"></p>
            </section>

            <section class="auth-pane auth-pane-status">
              <div class="auth-header">
                <h3>会话状态</h3>
                <button id="copyTokenBtn" class="btn ghost small">复制 Token</button>
              </div>
              <div class="session-metrics">
                <div class="session-item">
                  <span>状态</span>
                  <strong id="sessionState" class="session-state-offline">未登录</strong>
                </div>
                <div class="session-item">
                  <span>用户</span>
                  <strong id="sessionUser">-</strong>
                </div>
                <div class="session-item">
                  <span>角色</span>
                  <strong id="sessionRole">-</strong>
                </div>
              </div>
              <div class="token-preview-wrap">
                <span>Token 预览</span>
                <code id="tokenPreview">-</code>
              </div>
            </section>
          </div>

          <details id="authRawToggle" class="auth-raw">
            <summary>查看原始响应（调试）</summary>
            <pre id="loginResult">尚未请求</pre>
          </details>
        </article>
      </section>

      <section class="view" data-view="ingest">
        <article class="card reveal">
          <div class="card-head">
            <h3>日志上传</h3>
            <span class="tip">支持 JSON 行或纯文本日志</span>
          </div>
          <input type="file" id="logFile" class="file-input">
          <div class="inline-actions">
            <button id="uploadBtn" class="btn solid">上传并解析</button>
            <button id="fillDemoIngestBtn" class="btn ghost">填入示例时间</button>
          </div>
          <div class="upload-summary">
            <div class="upload-metric">
              <span>总行数</span>
              <strong id="uploadTotal">-</strong>
            </div>
            <div class="upload-metric">
              <span>成功数</span>
              <strong id="uploadSuccess">-</strong>
            </div>
            <div class="upload-metric">
              <span>失败数</span>
              <strong id="uploadFailed">-</strong>
            </div>
          </div>
          <p id="uploadHint" class="tip upload-tip"></p>
          <details id="uploadRawToggle" class="auth-raw upload-raw">
            <summary>查看原始响应（调试）</summary>
            <pre id="uploadResult">尚未上传</pre>
          </details>
        </article>
      </section>

      <section class="view" data-view="trend">
        <article class="card reveal">
          <div class="card-head">
            <h3>错误趋势</h3>
          </div>
          <div class="field-grid two">
            <label class="field">
              <span>状态码</span>
              <input id="errorCode" value="500">
            </label>
            <label class="field">
              <span>时间桶（分钟）</span>
              <input id="bucketMinutes" value="60">
            </label>
          </div>
          <div class="inline-actions">
            <button id="trendBtn" class="btn warm">生成趋势</button>
          </div>
          <div id="trendChart" class="chart"></div>
        </article>
      </section>

      <section class="view" data-view="compare">
        <article class="card reveal">
          <div class="card-head">
            <h3>区间对比</h3>
          </div>
          <div class="field-grid two">
            <label class="field">
              <span>区间 A 开始</span>
              <input id="start1" value="2025-01-01 00:00:00">
            </label>
            <label class="field">
              <span>区间 A 结束</span>
              <input id="end1" value="2025-01-02 00:00:00">
            </label>
            <label class="field">
              <span>区间 B 开始</span>
              <input id="start2" value="2025-01-03 00:00:00">
            </label>
            <label class="field">
              <span>区间 B 结束</span>
              <input id="end2" value="2025-01-04 00:00:00">
            </label>
          </div>
          <div class="inline-actions">
            <button id="compareBtn" class="btn warm">生成对比</button>
          </div>
          <div id="compareChart" class="chart"></div>
        </article>
      </section>

      <section class="view" data-view="runtime">
        <article class="card reveal">
          <div class="card-head">
            <h3>运行日志</h3>
          </div>
          <pre id="debugLog"></pre>
        </article>
      </section>
    </main>
  </div>

  <script src="/vendor/echarts.min.js"></script>
  <script src="/assets/app.js"></script>
</body>
</html>
